<div class="content-wrapper">
  <!-- Content Header (Page header) -->
  <div class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1 class="m-0">Vehicle Breakdown Tab
          </h1>
        </div><!-- /.col -->
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item active"><a href="#">Home</a></li>
          </ol>
        </div><!-- /.col -->
      </div><!-- /.row -->
    </div><!-- /.container-fluid -->
  </div>
  <!-- /.content-header -->

  <!-- Main content -->
  <section class="content">
    <div class="container-fluid">

      <!-- Breakdown Vehicle Form -->
      <div class="breakdown-form-container breakdown_form" id="vehicle_breakdown_form" *ngIf="isOpen_form">
        <div class="form-header">
          <h4>Update Vehicle Breakdown Form</h4>
          <button type="button" class="close" aria-label="Close" (click)="close_breakdown_form()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <form [formGroup]="breakdownForm" (ngSubmit)="onSubmit()">
          <div class="row">
            <!-- Vehicle Number -->
            <div class="col-md-6 form-group">
              <label for="vehicleNumber">Vehicle Number <span class="required">*</span></label>
              <input type="text" class="form-control" id="vehicleNumber" formControlName="vehicleNumber"
                placeholder="Enter vehicle number">
              <small class="error-text"
                *ngIf="breakdownForm.get('vehicleNumber')?.invalid && breakdownForm.get('vehicleNumber')?.touched">
                Vehicle number is required
              </small>
            </div>

            <!-- Route Number -->
            <div class="col-md-6 form-group">
              <label for="routeNumber">Route Number <span class="required">*</span></label>
              <input type="text" class="form-control" id="routeNumber" formControlName="routeNumber"
                placeholder="Enter route number">
              <small class="error-text"
                *ngIf="breakdownForm.get('routeNumber')?.invalid && breakdownForm.get('routeNumber')?.touched">
                Route number is required
              </small>
            </div>
          </div>

          <div class="row">
            <!-- Driver ID -->
            <div class="col-md-6 form-group">
              <label for="driverId">Driver ID <span class="required">*</span></label>
              <input type="text" class="form-control" id="driverId" formControlName="driverId"
                placeholder="Enter driver ID">
              <small class="error-text"
                *ngIf="breakdownForm.get('driverId')?.invalid && breakdownForm.get('driverId')?.touched">
                Driver ID is required
              </small>
            </div>

            <!-- Conductor ID -->
            <div class="col-md-6 form-group">
              <label for="conductorId">Conductor ID <span class="required">*</span></label>
              <input type="text" class="form-control" id="conductorId" formControlName="conductorId"
                placeholder="Enter conductor ID">
              <small class="error-text"
                *ngIf="breakdownForm.get('conductorId')?.invalid && breakdownForm.get('conductorId')?.touched">
                Conductor ID is required
              </small>
            </div>
          </div>

          <div class="row">
            <!-- Trip Completed -->
            <div class="col-md-6 form-group">
              <label for="tripCompleted">Trip Completed <span class="required">*</span></label>
              <input type="number" class="form-control" id="tripCompleted" formControlName="tripCompleted"
                placeholder="Enter trips completed">
              <small class="error-text"
                *ngIf="breakdownForm.get('tripCompleted')?.invalid && breakdownForm.get('tripCompleted')?.touched">
                Trip completed is required
              </small>
            </div>

            <!-- Kilometres Driven -->
            <div class="col-md-6 form-group">
              <label for="kmDriven">Kilometres Driven <span class="required">*</span></label>
              <input type="number" class="form-control" id="kmDriven" formControlName="kmDriven"
                placeholder="Enter km driven">
              <small class="error-text"
                *ngIf="breakdownForm.get('kmDriven')?.invalid && breakdownForm.get('kmDriven')?.touched">
                Kilometres driven is required
              </small>
            </div>
          </div>

          <div class="row">
            <!-- Place of Breakdown -->
            <div class="col-md-6 form-group">
              <label for="placeOfBreakdown">Place of Breakdown <span class="required">*</span></label>
              <input type="text" class="form-control" id="placeOfBreakdown" formControlName="placeOfBreakdown"
                placeholder="Enter location">
              <small class="error-text"
                *ngIf="breakdownForm.get('placeOfBreakdown')?.invalid && breakdownForm.get('placeOfBreakdown')?.touched">
                Place of breakdown is required
              </small>
            </div>

            <!-- Date of Breakdown -->
            <div class="col-md-6 form-group">
              <label for="dateOfBreakdown">Date of Breakdown <span class="required">*</span></label>
              <input type="date" class="form-control" id="dateOfBreakdown" formControlName="dateOfBreakdown">
              <small class="error-text"
                *ngIf="breakdownForm.get('dateOfBreakdown')?.invalid && breakdownForm.get('dateOfBreakdown')?.touched">
                Date of breakdown is required
              </small>
            </div>
          </div>

          <div class="row">
            <!-- Time of Breakdown -->
            <div class="col-md-6 form-group">
              <label for="timeOfBreakdown">Time of Breakdown <span class="required">*</span></label>
              <input type="time" class="form-control" id="timeOfBreakdown" formControlName="timeOfBreakdown">
              <small class="error-text"
                *ngIf="breakdownForm.get('timeOfBreakdown')?.invalid && breakdownForm.get('timeOfBreakdown')?.touched">
                Time of breakdown is required
              </small>
            </div>

            <!-- Cause of Breakdown -->
            <div class="col-md-6 form-group">
              <label for="causeOfBreakdown">Cause of Breakdown <span class="required">*</span></label>
              <input type="text" class="form-control" id="causeOfBreakdown" formControlName="causeOfBreakdown"
                placeholder="Enter cause of breakdown">
              <small class="error-text"
                *ngIf="breakdownForm.get('causeOfBreakdown')?.invalid && breakdownForm.get('causeOfBreakdown')?.touched">
                Cause of breakdown is required
              </small>
            </div>
          </div>

          <div class="row">
            <!-- Remarks -->
            <div class="col-md-12 form-group">
              <label for="remarks">Remarks</label>
              <textarea class="form-control" id="remarks" formControlName="remarks" rows="3"
                placeholder="Enter any additional remarks"></textarea>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-success" [disabled]="breakdownForm.invalid">
              <i class="fa fa-save"></i> Submit
            </button>
            <button type="button" class="btn btn-warning" (click)="onReset()">
              <i class="fa fa-undo"></i> Reset
            </button>
            <button type="button" class="btn btn-outline-danger" (click)="close_breakdown_form()">
              <i class="fa fa-times"></i> Cancel
            </button>
          </div>
        </form>
      </div>


      <!-- Breakdown Table Records -->
      <div class="breakdown-container" *ngIf="!isOpen_form">
        <div class="table-header">
          <h3 class="mb-0">Breakdown Records</h3>
          <div class="header-buttons">
            <button class="btn btn-success" (click)="downloadReport()">
              <i class="fa fa-download"></i> Download Report
            </button>
          </div>
        </div>

        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>#</th>
                <th>Vehicle Number</th>
                <th>Route Number</th>
                <th>Driver ID</th>
                <th>Conductor ID</th>
                <th>Trip Completed</th>
                <th>Kilometres Driven</th>
                <th>Place of Breakdown</th>
                <th>Date of Breakdown</th>
                <th>Time of Breakdown</th>
                <th>Cause of Breakdown</th>
                <th>Remarks</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let record of BreakdownData; let i = index">
                <td>{{ getActualIndex(i) }}</td>
                <td>{{ record?.bus?.busNo }}</td>
                <td>{{ record.routeNo }}</td>
                <td>{{ record.driverId }}</td>
                <td>{{ record.conductorId }}</td>
                <td>{{ record.noOfTrip }}</td>
                <td>{{ record.totalOperated }}</td>
                <td>{{ record.placeOfBreakdown }}</td>
                <td>{{ record.date | date: 'dd/MM/yyyy' }}</td>
                <td>{{ record.stopTime }}</td>
                <td>{{ record.causeOfBreakdown }}</td>
                <td>{{ record.remarks }}</td>
                <td>
                  <button class="btn btn-sm btn-primary mr-1" (click)="open_breakdown_form()" title="Edit">
                    <i class="fa fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-danger" (click)="deleteBreakdown(record.id)" title="Delete">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
              <tr *ngIf="paginatedRecords.length === 0">
                <td colspan="13" class="text-center text-muted">No breakdown records found</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="pagination-container">
          <div class="pagination-info">
            <span>Showing {{ getStartIndex() }} to {{ getEndIndex() }} of {{ totalRecords }} entries</span>
          </div>

          <nav aria-label="Page navigation">
            <ul class="pagination mb-0">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a class="page-link" (click)="previousPage()" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>

              <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage">
                <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
              </li>

              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <a class="page-link" (click)="nextPage()" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>

    </div>
  </section>

</div>